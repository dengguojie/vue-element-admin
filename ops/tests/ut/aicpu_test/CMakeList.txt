# Copyright 2019-2020 Huawei Technologies Co., Ltd
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ============================================================================

project(cpu_kernels_ut)

set(CMAKE_CXX_STANDARD 11)

set(_proto_srcs
  "proto/me_tensor.proto"
  "proto/me_attr.proto"
  "proto/me_tensor_shape.proto"
  "proto/me_node_def.proto"
  "proto/me_types.proto"
)

# the output path of generated files
set(_proto_include "${CMAKE_CURRENT_BINARY_DIR}/proto_tmp")
protobuf_generate(opp _proto_cc _proto_h ${_proto_srcs})

set(CPU_KERNELS_DIR ${CANN_ROOT}/ops/built-in/aicpu/impl)

set(_cpu_kernels_utils
  ${CPU_KERNELS_DIR}/utils/bcast.cc
  ${CPU_KERNELS_DIR}/utils/eigen_tensor.cc
  ${CPU_KERNELS_DIR}/utils/sparse_group.cc
  ${CPU_KERNELS_DIR}/utils/sparse_tensor.cc
)

set(_cpu_kernels_src
  ${CPU_KERNELS_DIR}/kernels/normalized/concatv2_kernels.cc
)

set(_cpu_kernels_ut_files
  testcase/concatv2_utest.cpp
)

add_executable(cpu_kernels_ut
  ${_cpu_kernels_utils}
  ${_cpu_kernels_src}
  ${_cpu_kernels_ut_files}
)

target_include_directories(cpu_kernels_ut PRIVATE
  ${CPU_KERNELS_DIR}
)

target_link_libraries(cpu_kernels_ut PRIVATE
  protobuf
  c_sec
)

set(AICPU_UTEST "${INSTALL_PATH}/tests/ops/ut/aicpu")
cann_install(
  TARGET      cpu_kernels_ut
  FILES       $<TARGET_FILE:cpu_kernels_ut>
  DESTINATION "${AICPU_UTEST}"
)