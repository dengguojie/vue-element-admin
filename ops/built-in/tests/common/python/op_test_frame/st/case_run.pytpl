import os
from absl import flags, app
from op_test_frame.common import logger
from op_test_frame.st.case_out_runner import out_run

FLAGS = flags.FLAGS
flags.DEFINE_string("soc_version", None, "SOC VERSION")
flags.DEFINE_string("op", None, "Test case directory name of test op")
flags.DEFINE_string("case_name", None, "Case Name")


def main(args):
    soc_version = None
    case_name = None
    if not (len(args) == 1 and str(args[0]).endswith(".py")):
        logger.log_info("Use args in python file, args: [%s]" % ", ".join(args))
        if str(args[0]).endswith(".py"):
            args = args[:-1]
        if len(args) == 1:
            soc_version = args[0]
        elif len(args) == 2:
            soc_version = args[0]
            case_name = args[1]
        else:
            logger.log_info("Args error, args example: 1. ['Ascend310']   2. ['Ascend310', 'xxx_case_name']")
    else:
        if FLAGS.soc_version:
            soc_version = FLAGS.soc_version
        else:
            soc_version = os.environ.get("SOC_VERSION")
        if not soc_version:
            logger.log_err("Not set soc version, do nothing.")
            return
        case_name = FLAGS.case_name
    case_root_dir = os.path.dirname(os.path.dirname(os.path.realpath(__file__)))
    op_type = os.path.basename(os.path.dirname(os.path.realpath(__file__)))
    out_run(case_root_dir, soc_version, op_type, case_name)


if __name__ == "__main__":
    app.run(main)
    # app.run(main, ["Ascend310"])
