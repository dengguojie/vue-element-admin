# -*- coding: UTF-8 -*-
"""
Conv2DBackpropFilter  ut testcase
"""
conv2d_bp_filter_op_testcase = [
    # x_dtype, dedy_dtype, dw_dtype, x_shape, dedy_shape, dw_shape, x_format,
    # dw_format, dw_format, filter_size, stride, padding, expect, dataflow
    # base shape
    (
        "float16",
        "float16",
        "float32",
        (2, 32, 8, 8),
        (2, 64, 8, 8),
        (64, 32, 2, 2),
        "NCHW",
        "NCHW",
        "NCHW",
        (64, 32, 2, 2),
        (1, 1, 1, 1),
        "SAME",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 32, 9, 9),
        (2, 32, 4, 4),
        (32, 32, 3, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (32, 32, 3, 3),
        (1, 1, 2, 2),
        "VALID",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (1, 64, 9, 9),
        (1, 32, 4, 4),
        (32, 64, 3, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (32, 64, 3, 3),
        (1, 1, 2, 2),
        "VALID",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 25, 48, 72),
        (2, 25, 48, 72),
        (25, 25, 3, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (25, 25, 3, 3),
        (1, 1, 1, 1),
        "SAME",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 25, 1, 70000),
        (2, 25, 1, 70000),
        (25, 25, 1, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (25, 25, 1, 3),
        (0, 0, 1, 1),
        "SAME",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 25, 70000, 72),
        (2, 25, 70000, 72),
        (25, 25, 3, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (25, 25, 3, 3),
        (1, 1, 1, 1),
        "SAME",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 32, 9, 9, 1),
        (2, 32, 4, 4),
        (32, 32, 3, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (32, 32, 3, 3),
        (1, 1, 2, 2),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 32, 9, 9),
        (2, 32, 4, 4),
        (32, 32, 3, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (32, 32, 3, 3),
        (1, 1, 2),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 32, 9, 9),
        (2, 32, 4097, 4),
        (32, 32, 3, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (32, 32, 3, 3),
        (1, 1, 2, 2),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 32, 9, 9),
        (2, 32, 4, 4097),
        (32, 32, 3, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (32, 32, 3, 3),
        (1, 1, 2, 2),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 256, 1, 1),
        (2, 256, 1, 1),
        (1, 1, 256, 256),
        "NCHW",
        "NCHW",
        "HWCN",
        (1, 1, 256, 256),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 1, 1, 256),
        (2, 1, 1, 256),
        (1, 1, 256, 256),
        "NHWC",
        "NHWC",
        "HWCN",
        (1, 1, 256, 256),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 256, 1, 1, 1),
        (2, 256, 1, 1),
        (256, 256, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (256, 256, 1, 1),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 256, 1, 1),
        (2, 256, 1, 1, 1),
        (256, 256, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (256, 256, 1, 1),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 256, 1, 1),
        (2, 256, 1, 1),
        (256, 256, 1, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (256, 256, 1, 1),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 256, 1, 1),
        (2, 256, 1, 1),
        (256, 256, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (256, 256, 1, 1, 1),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # conv1d
    (
        "float16",
        "float16",
        "float32",
        (16, 256, 1, 496),
        (16, 256, 1, 496),
        (256, 256, 1, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (256, 256, 1, 3),
        (1, 1, 1, 1),
        "SAME",
        (1, 1, 1, 3),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (34, 4, 1, 992),
        (34, 1024, 1, 248),
        (1024, 4, 1, 41),
        "NCHW",
        "NCHW",
        "NCHW",
        (1024, 4, 1, 41),
        (1, 1, 1, 4),
        (0, 0, 20, 20),
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (32, 32, 1, 15890),
        (32, 32, 1, 15872),
        (32, 32, 1, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (32, 32, 1, 3),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 9),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (64, 1, 1, 3000),
        (64, 1, 1, 3000),
        (1, 1, 1, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (1, 1, 1, 3),
        (1, 1, 1, 1),
        "SAME",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (16, 64, 1, 7936),
        (16, 64, 1, 7936),
        (64, 64, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (64, 64, 1, 1),
        (1, 1, 1, 1),
        "VALID",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 16, 1, 128006),
        (2, 16, 1, 78206),
        (16, 16, 1, 250),
        "NCHW",
        "NCHW",
        "NCHW",
        (16, 16, 1, 250),
        (1, 1, 1, 1),
        "VALID",
        (1, 1, 1, 200),
        1,
        RuntimeError,
    ),
    (
        "float16",
        "float16",
        "float32",
        (16,3,3230,3230),
        (16,3,112,112),
        (3,3,8,8),
        "NCHW",
        "NCHW",
        "NCHW",
        (3,3,8,8),
        (1, 1, 29,29),
        "SAME",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    # group
    (
        "float16",
        "float16",
        "float32",
        (1, 64, 214, 214),
        (1, 128, 214, 214),
        (128, 4, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (128, 4, 1, 1),
        (1, 1, 1, 1),
        "VALID",
        (1, 1, 1, 1),
        16,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (1, 64, 214, 214),
        (1, 127, 214, 214),
        (127, 4, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (127, 4, 1, 1),
        (1, 1, 1, 1),
        "VALID",
        (1, 1, 1, 1),
        16,
        RuntimeError,
    ),
    (
        "float16",
        "float16",
        "float32",
        (1, 63, 214, 214),
        (1, 128, 214, 214),
        (128, 4, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (128, 4, 1, 1),
        (1, 1, 1, 1),
        "VALID",
        (1, 1, 1, 1),
        16,
        RuntimeError,
    ),
        (
        "float16",
        "float16",
        "float32",
        (16, 32, 38, 38),
        (16, 32, 2, 1),
        (32, 32, 37, 37),
        "NCHW",
        "NCHW",
        "NCHW",
        (32, 32, 37, 37),
        (1, 1, 1, 2),
        'VALID',
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 14, 14),
        (1, 16, 14, 14),
        (16, 16, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (16, 16, 1, 1),
        (1, 1, 1, 1),
        "VALID",
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # error (dilation_N != 1)
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 14, 14),
        (1, 16, 14, 14),
        (16, 16, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (16, 16, 1, 1),
        (1, 1, 1, 1),
        "VALID",
        (3, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # filter_size != dw_shape
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 14, 14),
        (1, 16, 14, 14),
        (16, 16, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (16, 5, 1, 1),
        (1, 1, 1, 1),
        "VALID",
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # error format
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 14, 14),
        (1, 16, 14, 14),
        (16, 16, 1, 1),
        "NHW",
        "NCHW",
        "NCHW",
        (16, 16, 1, 1),
        (1, 1, 1, 1),
        "VALID",
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # error format
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 14, 14),
        (1, 16, 14, 14),
        (16, 16, 1, 1),
        "NCHW",
        "NHW",
        "NCHW",
        (16, 16, 1, 1),
        (1, 1, 1, 1),
        "VALID",
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # error format
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 14, 14),
        (1, 16, 14, 14),
        (16, 16, 1, 1),
        "NCHW",
        "NCHW",
        "NHW",
        (16, 16, 1, 1),
        (1, 1, 1, 1),
        "VALID",
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # error pad_len
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 14, 14),
        (1, 16, 14, 14),
        (16, 16, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (16, 16, 1, 1),
        (1, 1, 1, 1),
        (0, 0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # error batchx!=batchy
    (
        "float16",
        "float16",
        "float32",
        (2, 16, 14, 14),
        (1, 16, 14, 14),
        (16, 16, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (16, 16, 1, 1),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # error filter_size != res_shape
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 14, 14),
        (1, 16, 14, 14),
        (16, 16, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (2, 16, 1, 1),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # error batchw!=Cy
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 14, 14),
        (1, 16, 14, 14),
        (2, 16, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (2, 16, 1, 1),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # error Cw!=Cx
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 14, 14),
        (1, 16, 14, 14),
        (16, 2, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (16, 2, 1, 1),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # error wdim unequal
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 14, 15),
        (1, 16, 14, 14),
        (16, 16, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (16, 16, 1, 1),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
    # error wdim unequal
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 14, 14),
        (1, 16, 14, 14),
        (16, 16, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (16, 16, 1, 1),
        (1, 1, 1, 1),
        (0, 0, 0, 0),
        (1, 1, 1, 1),
        1,
        RuntimeError,
    ),
]

op_support_info_testcase = [
(
        "float16",
        "float16",
        "float32",
        (2, 32, 8, 8),
        (2, 64, 8, 8),
        (64, 32, 2, 2),
        "NCHW",
        "NCHW",
        "NCHW",
        (64, 32, 2, 2),
        (1, 1, 1, 1),
        "SAME",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (34, 4, 1, 992),
        (34, 1024, 1, 248),
        (1024, 4, 1, 41),
        "NCHW",
        "NCHW",
        "NCHW",
        (1024, 4, 1, 41),
        (1, 1, 1, 4),
        (0, 0, 20, 20),
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (1, 64, 214, 214),
        (1, 127, 214, 214),
        (127, 4, 1, 1),
        "NCHW",
        "NCHW",
        "NCHW",
        (127, 4, 1, 1),
        (1, 1, 1, 1),
        "VALID",
        (1, 1, 1, 1),
        16,
        RuntimeError,
    ),

]

conv2d_bp_filter_compute_testcase = [
    # x_dtype, dedy_dtype, dw_dtype, x_shape, dedy_shape, dw_shape, x_format,
    # dw_format, dw_format, filter_size, stride, padding, expect, dataflow
    # base shape
    (
        "float16",
        "float16",
        "float32",
        (2, 32, 8, 8),
        (2, 64, 8, 8),
        (64, 32, 2, 2),
        "NCHW",
        "NCHW",
        "NCHW",
        (64, 32, 2, 2),
        (1, 1, 1, 1),
        "SAME",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 8, 8, 32),
        (2, 8, 8, 64),
        (64, 2, 2, 32),
        "NHWC",
        "NHWC",
        "NHWC",
        (64, 2, 2, 32),
        (1, 1, 1, 1),
        "SAME",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 8, 8, 32),
        (2, 8, 8, 64),
        (2, 2, 32, 64),
        "NHWC",
        "NHWC",
        "HWCN",
        (2, 2, 32, 64),
        (1, 1, 1, 1),
        "SAME",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (2, 32, 9, 9),
        (2, 32, 4, 4),
        (32, 32, 3, 3),
        "NCHW",
        "NCHW",
        "NCHW",
        (32, 32, 3, 3),
        (1, 1, 2, 2),
        "VALID",
        (1, 1, 1, 1),
        1,
        "success",
    ),
    (
        "float16",
        "float16",
        "float32",
        (1, 16, 300, 300),
        (1, 16, 5, 3),
        (16, 16, 258, 8),
        "NCHW",
        "NCHW",
        "NCHW",
        (16, 16, 258, 8),
        (1, 1, 15, 150),
        (9, 9, 9, 9),
        (1, 1, 1, 1),
        1,
        "success",
    )
]
